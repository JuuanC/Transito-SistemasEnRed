
@{
    ViewData["Title"] = "AdministrarPeritos";
    Layout = null;
}

<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documento sin título</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    
</head>

<body>
    <div class="container">
        <div class="row">
            <a onclick="mostrarCuadroAgregar();"><input class="btn btn-primary" type="button" value="Agregar"></a>
            <a href="/Perito/Principal"><input class="btn btn-primary" type="button" value="Regresar"></a>
        </div>
        <table class="table table-hover" id="tablaPeritos">
            <thead class="bg-primary">
                <tr>
                    <th scope="col">Num.</th>
                    <th scope="col">Nombre</th>
                    <th scope="col">Usuario</th>
                    <th scope="col">Cargo</th>
                    <th scope="col">Eliminar</th>
                    <th scope="col">Modificar</th>
                </tr>
            </thead>
            <tbody>
                @{
                    var contador = 1;
                    foreach (var perito in ViewBag.Peritos)
                    {
                        <tr>
                            <td>@(contador++)</td>
                            <td>@perito.Nombre</td>
                            <td>@perito.Usuario</td>
                            <td>@perito.Cargo</td>
                                <td onclick="eliminarPerito(@perito.IdPerito);"><a><input class="btn btn-danger" type="button" value="Eliminar"></a></td>
                                <td onclick="mostrarCuadroActualizar(); return false;">
                                    <a><input class="btn btn-primary" type="button" value="Modificar"></a>
                                </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>

    <div class="modal fade" id="dialogoAgregar" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Agregar perito</h5>
                </div>
                <div class="modal-body">
                    <form name="formaRegistro" id="formaRegistro" action="/Perito/Registro" method="post">
                        <div class="form-group">
                            <label for="recipient-name" class="col-form-label">Nombre:</label>
                            <input type="text" class="form-control" name="nombre" id="nombre">
                        </div>
                        <div class="form-group">
                            <label for="recipient-name" class="col-form-label">Cargo:</label>
                            <select id="cargo" name="cargo" class="btn btn-primary">
                                <option value="Administrador">Administrador</option>
                                <option value="Perito">Perito</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="recipient-name" class="col-form-label">Usuario:</label>
                            <input type="text" class="form-control" name="usuario" id="usuario">
                        </div>
                        <div class="form-group">
                            <label for="recipient-name" class="col-form-label">Contraseña:</label>
                            <input type="password" class="form-control" name="contrasenia" id="contrasenia">
                        </div>
                        <div class="form-group">
                            <label for="recipient-name" class="col-form-label">Confirmar contraseña:</label>
                            <input type="password" class="form-control" id="contrasenia2">
                        </div>
                        <div id="panelErrores" class="text-danger hide col-md-offset-4" style="margin-bottom:10px;">

                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                            <input type="button" class="btn btn-primary" onclick="validar_enviar(); return false;" value="Guardar">
                        </div>

                        <div class="modal fade" tabindex="-1" role="dialog" id="dialogoRegistroCorrecto">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                        <h4 class="modal-title">Registro de Usuario</h4>
                                    </div>
                                    <div class="modal-body">
                                        <p>El usuario fue agregado de manera correcta. A continuación podrá continuar con el proceso...</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>

                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal-dialog -->
                        </div><!-- /.modal -->

                        <script>
                            function validar_enviar() {

                                var nombre = $("#nombre").val();
                                var cargo = $("#cargo").val();
                                var usuario = $("#usuario").val();
                                var contrasenia = $("#contrasenia").val();
                                var contrasenia2 = $("#contrasenia2").val();
                                var hayErrores = false;
                                var errores = "";
                                $("#panelErrores").addClass("hide");

                                if (contrasenia != contrasenia2) {
                                    hayErrores = true;
                                    errores = "<li>No coincide el password y su comprobación. Favor de verificar"
                                }

                                if (hayErrores) {
                                    $("#panelErrores").html(errores);
                                    $("#panelErrores").removeClass("hide");
                                } else {
                                    $.ajax({
                                        url: "/Perito/Registro",
                                        data: {
                                            "nombre": nombre,
                                            "cargo": cargo,
                                            "usuario": usuario,
                                            "contrasenia": contrasenia,
                                        },
                                        type: 'POST',
                                        success: function (datos) {
                                            var resp = jQuery.parseJSON(datos);
                                            if (resp.correcto === "si") {
                                                $("#dialogoRegistroCorrecto").modal("show");
                                                location.reload();
                                                $("#dialogoAgregar").modal("hide");
                                            } else {
                                                errores = "<li>No se pudo registrar el perito."
                                                $("#panelErrores").html(errores);
                                                $("#panelErrores").removeClass("hide");
                                            }
                                        }
                                    });
                                    //$("#forma").submit();
                                }
                            }
                        </script>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="dialogoActualizar" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Actualizar perito</h5>
                </div>
                <div class="modal-body">
                    <form name="formaRegistro" id="formaActualizar" action="/Perito/Actualizar" method="put">
                        <div class="form-group">
                            <label for="recipient-name" class="col-form-label">Nombre:</label>
                            <input type="text" class="form-control" name="nombre" id="nombreActualizar">
                        </div>
                        <div class="form-group">
                            <label for="recipient-name" class="col-form-label">Cargo:</label>
                            <select id="cargo" name="cargo">
                                <option value="Administrador">Administrador</option>
                                <option value="Perito">Perito</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="recipient-name" class="col-form-label">Usuario:</label>
                            <input type="text" class="form-control" name="usuario" id="usuarioActualizar">
                        </div>
                        <div class="form-group">
                            <label for="recipient-name" class="col-form-label">Contraseña:</label>
                            <input type="password" class="form-control" name="contrasenia" id="contraseniaActualizar">
                        </div>
                        <div class="form-group">
                            <label for="recipient-name" class="col-form-label">Confirmar contraseña:</label>
                            <input type="password" class="form-control" id="contrasenia2">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                            <input type="button" id="boton" class="btn btn-primary" onclick="guardar(); return false;" value="Guardar">
                        </div>

                        <script>
                            function validar_enviar() {

                                var nombre = $("#nombre").val();
                                var cargo = $("#cargo").val();
                                var usuario = $("#usuario").val();
                                var contrasenia = $("#contrasenia").val();
                                var contrasenia2 = $("#contrasenia2").val();
                                var hayErrores = false;
                                var errores = "";
                                $("#panelErrores").addClass("hide");

                                if (contrasenia != contrasenia2) {
                                    hayErrores = true;
                                    errores = "<li>No coincide el password y su comprobación. Favor de verificar"
                                }

                                if (hayErrores) {
                                    $("#panelErrores").html(errores);
                                    $("#panelErrores").removeClass("hide");
                                } else {
                                    $.ajax({
                                        url: "/Perito/Registro",
                                        data: {
                                            "nombre": nombre,
                                            "cargo": cargo,
                                            "usuario": usuario,
                                            "contrasenia": contrasenia,
                                        },
                                        type: 'POST',
                                        success: function (datos) {
                                            var resp = jQuery.parseJSON(datos);
                                            if (resp.correcto === "si") {
                                                $("#dialogoRegistroCorrecto").modal("show");
                                                location.reload();
                                                $("#dialogoAgregar").modal("hide");
                                            } else {
                                                errores = "<li>No se pudo registrar el perito."
                                                $("#panelErrores").html(errores);
                                                $("#panelErrores").removeClass("hide");
                                            }
                                        }
                                    });
                                    //$("#forma").submit();
                                }
                            }
                        </script>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        function mostrarCuadroAgregar() {
            $("#dialogoAgregar").modal("show");
        }
    </script>

    <script>
        function eliminarPerito(id) {
        $.ajax({
            url: "/Perito/Eliminar",
            data: {
                "idPerito": id,
            },
            type: 'DELETE',
            success: function (datos) {
                var resp = jQuery.parseJSON(datos);
                if (resp.correcto === "si") {
                    alert("Perito eliminado exitosamente");
                    location.reload();
                } else {
                    alert("No se pudo eliminar el perito");
                    location.reload();
                }
            }
        });
        }
    </script>

    <script>
        function mostrarCuadroActualizar() {
            $("#dialogoActualizar").modal("show");
            $("#nombreActualizar").html("Prueba");
            $("#cargoActualizar").html("prueba");
            $("#usuarioActualizar").html("Prueba");
            $("#contraseniaActualizar").html("Prueba");
        }
    </script>
</body>
</html>


